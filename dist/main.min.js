(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/AI.js":[function(require,module,exports){
/**
 * Created by saurabhk on 12/07/16.
 */
/*
 * Constructs an action that the ai player could make
 * @param pos [Number]: the cell position the ai would make its action in
 * made that action
 */
var AIAction = function(pos) {

    // public : the position on the board that the action would put the letter on
    this.movePosition = pos;

    //public : the minimax value of the state that the action leads to when applied
    this.minimaxVal = 0;

    /*
     * public : applies the action to a state to get the next state
     * @param state [State]: the state to apply the action to
     * @return [State]: the next state
     */
    this.applyTo = function(state) {
        var next = new State(state);

        //put the letter on the board
        next.boardState[this.movePosition[0]][this.movePosition[1]]  = state.turn ? "X" : "O";
        next.lastMove.x = this.movePosition[1];
        next.lastMove.y = this.movePosition[0];

        if(!state.turn){
            next.oMovesCount++;
        }
        next.turn  = !next.turn;

        //next.advanceTurn();

        return next;
    }
};

/*
 * public static function that defines a rule for sorting AIActions in ascending manner
 * @param firstAction [AIAction] : the first action in a pairwise sort
 * @param secondAction [AIAction]: the second action in a pairwise sort
 * @return [Number]: -1, 1, or 0
 */
AIAction.ASCENDING = function(firstAction, secondAction) {
    if(firstAction.minimaxVal < secondAction.minimaxVal)
        return -1; //indicates that firstAction goes before secondAction
    else if(firstAction.minimaxVal > secondAction.minimaxVal)
        return 1; //indicates that secondAction goes before firstAction
    else
        return 0; //indicates a tie
}

/*
 * public static function that defines a rule for sorting AIActions in descending manner
 * @param firstAction [AIAction] : the first action in a pairwise sort
 * @param secondAction [AIAction]: the second action in a pairwise sort
 * @return [Number]: -1, 1, or 0
 */
AIAction.DESCENDING = function(firstAction, secondAction) {
    if(firstAction.minimaxVal > secondAction.minimaxVal)
        return -1; //indicates that firstAction goes before secondAction
    else if(firstAction.minimaxVal < secondAction.minimaxVal)
        return 1; //indicates that secondAction goes before firstAction
    else
        return 0; //indicates a tie
}


/*
 * Constructs an AI player with a specific level of intelligence
 * @param level [String]: the desired level of intelligence
 */
var AI = function(level) {

    //private attribute: level of intelligence the player has
    var levelOfIntelligence = level;

    //private attribute: the game the player is playing
    var game = {};

    /*
     * private recursive function that computes the minimax value of a game state
     * @param state [State] : the state to calculate its minimax value
     * @returns [Number]: the minimax value of the state
     */
    function minimaxValue(state) {
        times = times + 1;
        if(state.isStateTerminal()) {
            //a terminal game state is the base case
            return game.score(state);
        }
        else {
            var stateScore; // this stores the minimax value we'll compute

            if(state.turn)
            // X wants to maximize --> initialize to a value smaller than any possible score
                stateScore = -1000;
            else
            // O wants to minimize --> initialize to a value larger than any possible score
                stateScore = 1000;

            var availablePositions = state.emptyCells();

            //enumerate next available states using the info form available positions
            var availableNextStates = availablePositions.map(function(pos) {
                var action = new AIAction(pos);

                return action.applyTo(state);
            });
            /* calculate the minimax value for all available next states
             * and evaluate the current state's value */
            availableNextStates.forEach(function(nextState) {
                var nextScore = minimaxValue(nextState);
                if(state.turn) {
                    // X wants to maximize --> update stateScore iff nextScore is larger
                    if(nextScore > stateScore)
                        stateScore = nextScore;
                }
                else {
                    // O wants to minimize --> update stateScore iff nextScore is smaller
                    if(nextScore < stateScore)
                        stateScore = nextScore;
                }
            });

            return stateScore;
        }
    }

    /*
     * private function: make the ai player take a blind move
     * that is: choose the cell to place its symbol randomly
     * @param turn [String]: the player to play, either X or O
     */
    function takeABlindMove() {
        var available = game.currentState.emptyCells();
        var randomCell = available[Math.floor(Math.random() * available.length)];
        var action = new AIAction(randomCell);

        var next = action.applyTo(game.currentState);

        game.advanceToState(next);
    }

    /*
     * private function: make the ai player take a novice move,
     * that is: mix between choosing the optimal and suboptimal minimax decisions
     * @param turn [String]: the player to play, either X or O
     */
    function takeANoviceMove() {
        var available = game.currentState.emptyCells();

        //enumerate and calculate the score for each available actions to the ai player
        var availableActions = available.map(function(pos) {
            var action =  new AIAction(pos); //create the action object
            var nextState = action.applyTo(game.currentState); //get next state by applying the action

            action.minimaxVal = minimaxValue(nextState); //calculate and set the action's minimax value

            return action;
        });

        //sort the enumerated actions list by score
        if(turn === "X")
        //X maximizes --> sort the actions in a descending manner to have the action with maximum minimax at first
            availableActions.sort(AIAction.DESCENDING);
        else
        //O minimizes --> sort the actions in an ascending manner to have the action with minimum minimax at first
            availableActions.sort(AIAction.ASCENDING);

        /*
         * take the optimal action 40% of the time, and take the 1st suboptimal action 60% of the time
         */
        var chosenAction;
        if(Math.random()*100 <= 40) {
            chosenAction = availableActions[0];
        }
        else {
            if(availableActions.length >= 2) {
                //if there is two or more available actions, choose the 1st suboptimal
                chosenAction = availableActions[1];
            }
            else {
                //choose the only available actions
                chosenAction = availableActions[0];
            }
        }
        var next = chosenAction.applyTo(game.currentState);

        game.advanceToState(next);
    }

    /*
     * private function: make the ai player take a master move,
     * that is: choose the optimal minimax decision
     * @param turn [String]: the player to play, either X or O
     */
    function takeAMasterMove() {
        var available = game.currentState.emptyCells();
        //enumerate and calculate the score for each avaialable actions to the ai player
        var availableActions = available.map(function(pos) {
            var action =  new AIAction(pos); //create the action object
            var next = action.applyTo(game.currentState); //get next state by applying the action
            action.minimaxVal = minimaxValue(next); //calculate and set the action's minmax value
            return action;
        });
        //sort the enumerated actions list by score
        //if(turn === "X")
        ////X maximizes --> sort the actions in a descending manner to have the action with maximum minimax at first
        //    availableActions.sort(AIAction.DESCENDING);
        //else
        //O minimizes --> sort the actions in an ascending manner to have the action with minimum minimax at first
        availableActions.sort(AIAction.ASCENDING);


        //take the first action as it's the optimal
        var chosenAction = availableActions[0];
        game.renderPiece(chosenAction.movePosition[1], chosenAction.movePosition[0], false);
        var next = chosenAction.applyTo(game.currentState);
        game.advanceToState(next);
    }


    /*
     * public method to specify the game the ai player will play
     * @param _game [Game] : the game the ai will play
     */
    this.plays = function(_game){
        game = _game;
    };

    /*
     * public function: notify the ai player that it's its turn
     * @param turn [String]: the player to play, either X or O
     */
    this.makeMove = function() {
        switch(levelOfIntelligence) {
            //invoke the desired behavior based on the level chosen
            case "blind": takeABlindMove(); break;
            case "novice": takeANoviceMove(); break;
            case "master": takeAMasterMove(); break;
        }
    };
};

module.exports = AI;
},{}],"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/config.js":[function(require,module,exports){
/**
 * Created by saurabhk on 10/07/16.
 */
module.exports = {
    graphicPadding: 50,
    gameBoundaryWidth:10
};
},{}],"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/entities/player.js":[function(require,module,exports){
var Player = function (game, x, y) {
    Phaser.Sprite.call(this, game, x, y, 'testsprite');
    game.add.existing(this);
};

Player.prototype = Object.create(Phaser.Sprite.prototype);
Player.prototype.constructor = Player;

/**
 * Automatically called by World.update
 */
Player.prototype.update = function () {
};

module.exports = Player;

},{}],"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/main.js":[function(require,module,exports){
'use strict';

var game = new Phaser.Game(800, 600, Phaser.AUTO, 'tictactoe-game');

window.Utils = require('./utils/utils');
require('./utils/prototype');
window.playerState = {
    currentLevel: 'Game'
};
window.globalUser = {};
globalUser.settings = {
    grids:3
};
globalUser.playingOverNetwork = false;
window.times = 0;

game.state.add('Boot', require('./states/boot'));
game.state.add('Splash', require('./states/splash'));
game.state.add('Preloader', require('./states/preloader'));
game.state.add('Menu', require('./states/menu'));
game.state.add('Game', require('./states/game'));
game.state.add('GameOver', require('./states/gameOver'));

game.state.start('Boot');

},{"./states/boot":"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/states/boot.js","./states/game":"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/states/game.js","./states/gameOver":"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/states/gameOver.js","./states/menu":"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/states/menu.js","./states/preloader":"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/states/preloader.js","./states/splash":"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/states/splash.js","./utils/prototype":"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/utils/prototype.js","./utils/utils":"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/utils/utils.js"}],"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/states/boot.js":[function(require,module,exports){
var Boot = function () {
};

module.exports = Boot;

Boot.prototype = {

    preload: function () {
        this.load.image('preloader', 'assets/preloader.gif');
    },

    create: function () {
        this.game.input.maxPointers = 1;
        this.game.stage.backgroundColor = "#ffffff";
        if (this.game.device.desktop) {
            this.game.stage.scale.pageAlignHorizontally = true;
        } else {
            this.game.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
            this.game.scale.minWidth = 480;
            this.game.scale.minHeight = 260;
            this.game.scale.maxWidth = 640;
            this.game.scale.maxHeight = 480;
            //this.game.scale.forceLandscape = true;
            this.game.scale.pageAlignHorizontally = true;
            this.game.scale.updateLayout(true);
        }

        this.game.state.start('Preloader');
    }
};

},{}],"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/states/game.js":[function(require,module,exports){
var Player = require('../entities/player');
var config = require('../config');
var utils = require('../utils/utils');

// Not state of phaser but game
function State(oldState) {
    var i,j;
    this.turn = Math.random() > 0.3;
    this.boardState = [];
    this.oMovesCount = 0;
    this.lastMove = {};
    this.status = "beginning";
    this.result = "running";

    if(typeof oldState !== "undefined") {
        // if the state is constructed using a copy of another state
        this.boardState = JSON.parse(JSON.stringify(oldState.boardState));

        this.oMovesCount = oldState.oMovesCount;
        this.turn = oldState.turn;
    } else {
        // Initialize board state with all 0 by default
        for(i = 0; i < globalUser.settings.grids; i++) {
            for(j = 0; j < globalUser.settings.grids; j++) {
                if (this.boardState[i]) {
                    this.boardState[i][j] = 0
                } else {
                    this.boardState[i] = [];
                    this.boardState[i][j] = 0
                }
            }
        }
    }
}

State.prototype = {
    isStateTerminal: function() {
        var x, y;
        var diagonals = [[], []];
        // Check rows
        for (x = 0; x < this.boardState.length; x++) {
            var row = this.boardState[x];
            if (row[0] != 0 && row.isSingleValued()) {
                this.result = this.turn ? "O" : "X";
                return true;
            }
        }

        // Check columns
        for (x = 0; x < globalUser.settings.grids; x++) {
            var col = this.boardState.map(function (value) {
                return value[x];
            });
            if (col[0] != 0 && col.isSingleValued()) {
                this.result = this.turn ? "O" : "X";
                return true;
            }
        }

        // Check diagonals
        for (x = 0; x < globalUser.settings.grids; x++) {
            for (y = 0; y < globalUser.settings.grids; y++) {
                if (x == y) {
                    diagonals[0].push(this.boardState[x][y]);
                    diagonals[1].push(this.boardState[globalUser.settings.grids - 1 - x][y]);
                }

            }
        }

        for (x = 0; x < diagonals.length; x++) {
            var diagonal = diagonals[x];
            if (diagonal[0] != 0 && diagonal.isSingleValued()) {
                this.result = this.turn ? "O" : "X";
                return true;
            }
        }

        // Check Draw
        if(this.emptyCells().length == 0) {
            this.result = "Match Drawn";
            return true;
        }
    },

    emptyCells: function() {
        var x,y;
        var emptyCells = [];
        for(x = 0;x < globalUser.settings.grids;x++) {
            for(y = 0;y < globalUser.settings.grids;y++) {
                if(this.boardState[x][y] == 0) {
                    emptyCells.push([x,y]);
                }
            }
        }
        return emptyCells;
    }
};

var Game = {

    preload: function() {
        this.opponent = "AI";
        this.graphics = null;
        this.sectionSize = null;
        this.result = "running";
        this.difficultyLevel = null;
        this.currentState = new State();
        this.messageOne = "";
        this.messageTwo = "";
        globalUser.AI.plays(this);
    },

    create: function () {
        var i, j;
        var graphics = this.game.add.graphics(config.graphicPadding, config.graphicPadding);
        this.graphics = graphics;
        this.setTurnMessages();
        var style = {font: "20px Arial", fill: "#66CDAA", align: "center"};

        this.textMessage = this.add.text(200, 0, this.messageOne, style);

        // set a fill and line style
        graphics.lineStyle(config.gameBoundaryWidth, 0xdddddd);
        var gridDetails = utils.gridSize(this.game);

        // Vertical lines
        for (i = 1; i < globalUser.settings.grids; i++) {
            graphics.moveTo(i * gridDetails[0] + (i-1) * config.gameBoundaryWidth,0);
            graphics.lineTo(i * gridDetails[0] + (i-1) * config.gameBoundaryWidth, gridDetails[1]);
        }

        // Horizontal lines
        for (j = 1; j < globalUser.settings.grids; j++) {
            graphics.moveTo(0, j * gridDetails[0] + (j-1) * config.gameBoundaryWidth);
            graphics.lineTo(gridDetails[1], j * gridDetails[0] + (j-1) * config.gameBoundaryWidth);
        }
        this.sectionSize = gridDetails[1]/globalUser.settings.grids;
        this.input.onDown.add(this.addPlayingPiece, this);
        if (!this.currentState.turn && globalUser.AI) {
            this.game.time.events.add(Phaser.Timer.SECOND * 1, function(){
                globalUser.AI.makeMove();
                this.currentState.oMovesCount += 1;
            }, this);
        }

    },

    update: function () {
    },

    onInputDown: function () {
        this.game.state.start('Menu');
    },

    addPlayingPiece: function() {
        var xCordinate;
        var yCordinate;
        var sectionSize = this.sectionSize;
        var mouse = this.input.position;
        mouse.x = mouse.x - config.graphicPadding;
        mouse.y = mouse.y - config.graphicPadding;

        for (var x = 0;x < globalUser.settings.grids;x++) {
            for (var y = 0;y < globalUser.settings.grids;y++) {
                xCordinate = x * sectionSize;
                yCordinate = y * sectionSize;

                if (
                    mouse.x >= xCordinate && mouse.x <= xCordinate + sectionSize &&
                    mouse.y >= yCordinate && mouse.y <= yCordinate + sectionSize
                    ) {

                    //clearPlayingArea(xCordinate, yCordinate);
                    this.currentState.lastMove.x = x;
                    this.currentState.lastMove.y = y;

                    if(this.currentState.boardState[y][x] == 0) {
                        this.renderPiece(x,y, true);
                        this.currentState.turn = !this.currentState.turn;
                        this.currentState.boardState[y][x] = "X";
                        this.advanceToState(this.currentState);
                    }

                }
            }
        }
    },

    renderPiece: function(x, y, turn) {
        var xCordinate = x * this.sectionSize;
        var yCordinate = y * this.sectionSize;
        if(turn) {
            this.drawX(xCordinate, yCordinate);
        } else {
            this.drawO(xCordinate, yCordinate);
        }
        this.textMessage.text = this.textMessage.text == this.messageOne ? this.messageTwo :this.messageOne;
    },

    advanceToState: function(state) {
        this.currentState = state;
        if(this.currentState.isStateTerminal()) {
            state.status = "finished";
            this.textMessage.text= "";
            globalUser.result = state.result == "X" ? "You won" : (state.result == "O" ? "You Lose" : "Match Draw");
            this.game.state.start("GameOver",  false, true);
            return;
        }
        if (!state.turn) {
            if(globalUser.AI) {
                this.game.time.events.add(Phaser.Timer.SECOND * 1, function(){
                    globalUser.AI.makeMove();
                }, this);
            }
            state.oMovesCount += 1;
        }
        //state.turn = !state.turn;
    },

    drawO: function(x, y) {
        var sectionSize = this.sectionSize;
        var graphics = this.graphics;
        var halfSectionSize = (0.5 * sectionSize);
        var centerX = x + halfSectionSize;
        var centerY = y + halfSectionSize;
        var diameter = sectionSize * 0.4;
            graphics.lineStyle(10, 0x01bBC2);
            graphics.drawCircle(centerX, centerY, diameter);

    },

    drawX: function(x,y) {
        var graphics = this.graphics;
        var sectionSize = this.sectionSize;
        graphics.lineStyle(10, 0xf1be32);
        var offset = sectionSize * 0.3;
        graphics.moveTo(x + offset, y + offset);
        graphics.lineTo(x + sectionSize - offset, y + sectionSize - offset);

        graphics.moveTo(x + offset, y + sectionSize - offset);
        graphics.lineTo(x + sectionSize - offset, y + offset);
    },

    score: function(_state) {
        if(_state.result === "X"){
            // the x player won
            return 10 - _state.oMovesCount;
        }
        else if(_state.result === "O") {
            //the x player lost
            return - 10 + _state.oMovesCount;
        }
        else {
            //it's a draw
            return 0;
        }
    },

    setTurnMessages: function() {
        if(globalUser.AI) {
            if(this.currentState.turn) {
                this.messageOne = "Your turn, make your move";
                this.messageTwo = "Please wait, AI is thinking";
            } else {
                this.messageTwo = "Your turn, make your move";
                this.messageOne = "Please wait, AI is thinking";
            }
        } else if(globalUser.playingOverNetwork) {

        } else {
            this.messageOne = "Player one's turn";
            this.messageTwo = "Player two's turn";
        }
    }
};

// Export Game and make State global
window.State = State;
module.exports = Game;

},{"../config":"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/config.js","../entities/player":"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/entities/player.js","../utils/utils":"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/utils/utils.js"}],"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/states/gameOver.js":[function(require,module,exports){
/**
 * Created by saurabhk on 11/07/16.
 */
var GameOver = function () {
    this.text = null;
};

module.exports = GameOver;

GameOver.prototype = {

    create: function () {
        var x = this.game.width / 2;
        var y = this.game.height / 2;

        var style = {font: "25px Arial", fill: "#dddddd", align: "center"};

        this.text = this.add.text(x - 300, 0, "GameOver, "+globalUser.result+" click to play again", style);

        this.input.onDown.add(this.onDown, this);
    },

    update: function () {
    },

    onDown: function () {
        this.game.state.start(playerState.currentLevel);
    }
};

},{}],"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/states/menu.js":[function(require,module,exports){
var AI = require("../AI");
var Menu = function () {
    this.text = null;
};

module.exports = Menu;

Menu.prototype = {

    create: function () {
        var x = this.game.width / 2;
        var y = this.game.height / 2;

        var style = {font: "65px Arial", fill: "#dddddd", align: "center"};

        this.text = this.add.text(x - 300, y - 200, "Press to Start", style);

        this.input.onDown.add(this.onDown, this);
    },

    update: function () {
    },

    onDown: function () {
        window.globalUser.AI = new AI("master");
        this.game.state.start(playerState.currentLevel);
    }
};

},{"../AI":"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/AI.js"}],"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/states/preloader.js":[function(require,module,exports){
var Preloader = function (game) {
    this.asset = null;
    this.ready = false;
};

module.exports = Preloader;

Preloader.prototype = {

    preload: function () {
        this.asset = this.add.sprite(320, 240, 'preloader');
        this.asset.anchor.setTo(0.5, 0.5);

        this.load.onLoadComplete.addOnce(this.onLoadComplete, this);
        this.load.setPreloadSprite(this.asset);
        this.load.image('testsprite', 'assets/test.png');
    },

    create: function () {
        this.asset.cropEnabled = false;
    },

    update: function () {
        if (!!this.ready) {
            this.game.state.start('Menu');
        }
    },

    onLoadComplete: function () {
        this.ready = true;
    }
};

},{}],"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/states/splash.js":[function(require,module,exports){
var Splash = function () {
};

module.exports = Splash;

Splash.prototype = {
    create: function () {
    }
};
},{}],"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/utils/prototype.js":[function(require,module,exports){
/**
 * Created by saurabhk on 10/07/16.
 */
(function(){
    Array.prototype.isSingleValued = function() {
        return !!this.reduce(function(a, b){ return (a === b) ? a : NaN; });
    }
})();
},{}],"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/utils/utils.js":[function(require,module,exports){
"use strict";
var config = require('./../config');
var Utils = {
    containsObject: function (obj, list) {
        var i;
        for (i = 0; i < list.length; i++) {
            if (list[i] === obj) {
                return true;
            }
        }

        return false;
    },

    gridSize: function(game) {
        var gameWidth =  Math.min(game.width, game.height) - 2 * config.graphicPadding;
        var gridTotalWidth = gameWidth - (globalUser.settings.grids - 1) * config.gameBoundaryWidth;
        return [gridTotalWidth / globalUser.settings.grids, gameWidth];
    }
};

module.exports = Utils;
},{"./../config":"/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/config.js"}]},{},["/Users/saurabhk/Workspace/Playground/Node Projects/phaser/tictactoe/src/js/main.js"])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvanMvQUkuanMiLCJzcmMvanMvY29uZmlnLmpzIiwic3JjL2pzL2VudGl0aWVzL3BsYXllci5qcyIsInNyYy9qcy9tYWluLmpzIiwic3JjL2pzL3N0YXRlcy9ib290LmpzIiwic3JjL2pzL3N0YXRlcy9nYW1lLmpzIiwic3JjL2pzL3N0YXRlcy9nYW1lT3Zlci5qcyIsInNyYy9qcy9zdGF0ZXMvbWVudS5qcyIsInNyYy9qcy9zdGF0ZXMvcHJlbG9hZGVyLmpzIiwic3JjL2pzL3N0YXRlcy9zcGxhc2guanMiLCJzcmMvanMvdXRpbHMvcHJvdG90eXBlLmpzIiwic3JjL2pzL3V0aWxzL3V0aWxzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeFJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvKipcbiAqIENyZWF0ZWQgYnkgc2F1cmFiaGsgb24gMTIvMDcvMTYuXG4gKi9cbi8qXG4gKiBDb25zdHJ1Y3RzIGFuIGFjdGlvbiB0aGF0IHRoZSBhaSBwbGF5ZXIgY291bGQgbWFrZVxuICogQHBhcmFtIHBvcyBbTnVtYmVyXTogdGhlIGNlbGwgcG9zaXRpb24gdGhlIGFpIHdvdWxkIG1ha2UgaXRzIGFjdGlvbiBpblxuICogbWFkZSB0aGF0IGFjdGlvblxuICovXG52YXIgQUlBY3Rpb24gPSBmdW5jdGlvbihwb3MpIHtcblxuICAgIC8vIHB1YmxpYyA6IHRoZSBwb3NpdGlvbiBvbiB0aGUgYm9hcmQgdGhhdCB0aGUgYWN0aW9uIHdvdWxkIHB1dCB0aGUgbGV0dGVyIG9uXG4gICAgdGhpcy5tb3ZlUG9zaXRpb24gPSBwb3M7XG5cbiAgICAvL3B1YmxpYyA6IHRoZSBtaW5pbWF4IHZhbHVlIG9mIHRoZSBzdGF0ZSB0aGF0IHRoZSBhY3Rpb24gbGVhZHMgdG8gd2hlbiBhcHBsaWVkXG4gICAgdGhpcy5taW5pbWF4VmFsID0gMDtcblxuICAgIC8qXG4gICAgICogcHVibGljIDogYXBwbGllcyB0aGUgYWN0aW9uIHRvIGEgc3RhdGUgdG8gZ2V0IHRoZSBuZXh0IHN0YXRlXG4gICAgICogQHBhcmFtIHN0YXRlIFtTdGF0ZV06IHRoZSBzdGF0ZSB0byBhcHBseSB0aGUgYWN0aW9uIHRvXG4gICAgICogQHJldHVybiBbU3RhdGVdOiB0aGUgbmV4dCBzdGF0ZVxuICAgICAqL1xuICAgIHRoaXMuYXBwbHlUbyA9IGZ1bmN0aW9uKHN0YXRlKSB7XG4gICAgICAgIHZhciBuZXh0ID0gbmV3IFN0YXRlKHN0YXRlKTtcblxuICAgICAgICAvL3B1dCB0aGUgbGV0dGVyIG9uIHRoZSBib2FyZFxuICAgICAgICBuZXh0LmJvYXJkU3RhdGVbdGhpcy5tb3ZlUG9zaXRpb25bMF1dW3RoaXMubW92ZVBvc2l0aW9uWzFdXSAgPSBzdGF0ZS50dXJuID8gXCJYXCIgOiBcIk9cIjtcbiAgICAgICAgbmV4dC5sYXN0TW92ZS54ID0gdGhpcy5tb3ZlUG9zaXRpb25bMV07XG4gICAgICAgIG5leHQubGFzdE1vdmUueSA9IHRoaXMubW92ZVBvc2l0aW9uWzBdO1xuXG4gICAgICAgIGlmKCFzdGF0ZS50dXJuKXtcbiAgICAgICAgICAgIG5leHQub01vdmVzQ291bnQrKztcbiAgICAgICAgfVxuICAgICAgICBuZXh0LnR1cm4gID0gIW5leHQudHVybjtcblxuICAgICAgICAvL25leHQuYWR2YW5jZVR1cm4oKTtcblxuICAgICAgICByZXR1cm4gbmV4dDtcbiAgICB9XG59O1xuXG4vKlxuICogcHVibGljIHN0YXRpYyBmdW5jdGlvbiB0aGF0IGRlZmluZXMgYSBydWxlIGZvciBzb3J0aW5nIEFJQWN0aW9ucyBpbiBhc2NlbmRpbmcgbWFubmVyXG4gKiBAcGFyYW0gZmlyc3RBY3Rpb24gW0FJQWN0aW9uXSA6IHRoZSBmaXJzdCBhY3Rpb24gaW4gYSBwYWlyd2lzZSBzb3J0XG4gKiBAcGFyYW0gc2Vjb25kQWN0aW9uIFtBSUFjdGlvbl06IHRoZSBzZWNvbmQgYWN0aW9uIGluIGEgcGFpcndpc2Ugc29ydFxuICogQHJldHVybiBbTnVtYmVyXTogLTEsIDEsIG9yIDBcbiAqL1xuQUlBY3Rpb24uQVNDRU5ESU5HID0gZnVuY3Rpb24oZmlyc3RBY3Rpb24sIHNlY29uZEFjdGlvbikge1xuICAgIGlmKGZpcnN0QWN0aW9uLm1pbmltYXhWYWwgPCBzZWNvbmRBY3Rpb24ubWluaW1heFZhbClcbiAgICAgICAgcmV0dXJuIC0xOyAvL2luZGljYXRlcyB0aGF0IGZpcnN0QWN0aW9uIGdvZXMgYmVmb3JlIHNlY29uZEFjdGlvblxuICAgIGVsc2UgaWYoZmlyc3RBY3Rpb24ubWluaW1heFZhbCA+IHNlY29uZEFjdGlvbi5taW5pbWF4VmFsKVxuICAgICAgICByZXR1cm4gMTsgLy9pbmRpY2F0ZXMgdGhhdCBzZWNvbmRBY3Rpb24gZ29lcyBiZWZvcmUgZmlyc3RBY3Rpb25cbiAgICBlbHNlXG4gICAgICAgIHJldHVybiAwOyAvL2luZGljYXRlcyBhIHRpZVxufVxuXG4vKlxuICogcHVibGljIHN0YXRpYyBmdW5jdGlvbiB0aGF0IGRlZmluZXMgYSBydWxlIGZvciBzb3J0aW5nIEFJQWN0aW9ucyBpbiBkZXNjZW5kaW5nIG1hbm5lclxuICogQHBhcmFtIGZpcnN0QWN0aW9uIFtBSUFjdGlvbl0gOiB0aGUgZmlyc3QgYWN0aW9uIGluIGEgcGFpcndpc2Ugc29ydFxuICogQHBhcmFtIHNlY29uZEFjdGlvbiBbQUlBY3Rpb25dOiB0aGUgc2Vjb25kIGFjdGlvbiBpbiBhIHBhaXJ3aXNlIHNvcnRcbiAqIEByZXR1cm4gW051bWJlcl06IC0xLCAxLCBvciAwXG4gKi9cbkFJQWN0aW9uLkRFU0NFTkRJTkcgPSBmdW5jdGlvbihmaXJzdEFjdGlvbiwgc2Vjb25kQWN0aW9uKSB7XG4gICAgaWYoZmlyc3RBY3Rpb24ubWluaW1heFZhbCA+IHNlY29uZEFjdGlvbi5taW5pbWF4VmFsKVxuICAgICAgICByZXR1cm4gLTE7IC8vaW5kaWNhdGVzIHRoYXQgZmlyc3RBY3Rpb24gZ29lcyBiZWZvcmUgc2Vjb25kQWN0aW9uXG4gICAgZWxzZSBpZihmaXJzdEFjdGlvbi5taW5pbWF4VmFsIDwgc2Vjb25kQWN0aW9uLm1pbmltYXhWYWwpXG4gICAgICAgIHJldHVybiAxOyAvL2luZGljYXRlcyB0aGF0IHNlY29uZEFjdGlvbiBnb2VzIGJlZm9yZSBmaXJzdEFjdGlvblxuICAgIGVsc2VcbiAgICAgICAgcmV0dXJuIDA7IC8vaW5kaWNhdGVzIGEgdGllXG59XG5cblxuLypcbiAqIENvbnN0cnVjdHMgYW4gQUkgcGxheWVyIHdpdGggYSBzcGVjaWZpYyBsZXZlbCBvZiBpbnRlbGxpZ2VuY2VcbiAqIEBwYXJhbSBsZXZlbCBbU3RyaW5nXTogdGhlIGRlc2lyZWQgbGV2ZWwgb2YgaW50ZWxsaWdlbmNlXG4gKi9cbnZhciBBSSA9IGZ1bmN0aW9uKGxldmVsKSB7XG5cbiAgICAvL3ByaXZhdGUgYXR0cmlidXRlOiBsZXZlbCBvZiBpbnRlbGxpZ2VuY2UgdGhlIHBsYXllciBoYXNcbiAgICB2YXIgbGV2ZWxPZkludGVsbGlnZW5jZSA9IGxldmVsO1xuXG4gICAgLy9wcml2YXRlIGF0dHJpYnV0ZTogdGhlIGdhbWUgdGhlIHBsYXllciBpcyBwbGF5aW5nXG4gICAgdmFyIGdhbWUgPSB7fTtcblxuICAgIC8qXG4gICAgICogcHJpdmF0ZSByZWN1cnNpdmUgZnVuY3Rpb24gdGhhdCBjb21wdXRlcyB0aGUgbWluaW1heCB2YWx1ZSBvZiBhIGdhbWUgc3RhdGVcbiAgICAgKiBAcGFyYW0gc3RhdGUgW1N0YXRlXSA6IHRoZSBzdGF0ZSB0byBjYWxjdWxhdGUgaXRzIG1pbmltYXggdmFsdWVcbiAgICAgKiBAcmV0dXJucyBbTnVtYmVyXTogdGhlIG1pbmltYXggdmFsdWUgb2YgdGhlIHN0YXRlXG4gICAgICovXG4gICAgZnVuY3Rpb24gbWluaW1heFZhbHVlKHN0YXRlKSB7XG4gICAgICAgIHRpbWVzID0gdGltZXMgKyAxO1xuICAgICAgICBpZihzdGF0ZS5pc1N0YXRlVGVybWluYWwoKSkge1xuICAgICAgICAgICAgLy9hIHRlcm1pbmFsIGdhbWUgc3RhdGUgaXMgdGhlIGJhc2UgY2FzZVxuICAgICAgICAgICAgcmV0dXJuIGdhbWUuc2NvcmUoc3RhdGUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIHN0YXRlU2NvcmU7IC8vIHRoaXMgc3RvcmVzIHRoZSBtaW5pbWF4IHZhbHVlIHdlJ2xsIGNvbXB1dGVcblxuICAgICAgICAgICAgaWYoc3RhdGUudHVybilcbiAgICAgICAgICAgIC8vIFggd2FudHMgdG8gbWF4aW1pemUgLS0+IGluaXRpYWxpemUgdG8gYSB2YWx1ZSBzbWFsbGVyIHRoYW4gYW55IHBvc3NpYmxlIHNjb3JlXG4gICAgICAgICAgICAgICAgc3RhdGVTY29yZSA9IC0xMDAwO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgLy8gTyB3YW50cyB0byBtaW5pbWl6ZSAtLT4gaW5pdGlhbGl6ZSB0byBhIHZhbHVlIGxhcmdlciB0aGFuIGFueSBwb3NzaWJsZSBzY29yZVxuICAgICAgICAgICAgICAgIHN0YXRlU2NvcmUgPSAxMDAwO1xuXG4gICAgICAgICAgICB2YXIgYXZhaWxhYmxlUG9zaXRpb25zID0gc3RhdGUuZW1wdHlDZWxscygpO1xuXG4gICAgICAgICAgICAvL2VudW1lcmF0ZSBuZXh0IGF2YWlsYWJsZSBzdGF0ZXMgdXNpbmcgdGhlIGluZm8gZm9ybSBhdmFpbGFibGUgcG9zaXRpb25zXG4gICAgICAgICAgICB2YXIgYXZhaWxhYmxlTmV4dFN0YXRlcyA9IGF2YWlsYWJsZVBvc2l0aW9ucy5tYXAoZnVuY3Rpb24ocG9zKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IG5ldyBBSUFjdGlvbihwb3MpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbi5hcHBseVRvKHN0YXRlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLyogY2FsY3VsYXRlIHRoZSBtaW5pbWF4IHZhbHVlIGZvciBhbGwgYXZhaWxhYmxlIG5leHQgc3RhdGVzXG4gICAgICAgICAgICAgKiBhbmQgZXZhbHVhdGUgdGhlIGN1cnJlbnQgc3RhdGUncyB2YWx1ZSAqL1xuICAgICAgICAgICAgYXZhaWxhYmxlTmV4dFN0YXRlcy5mb3JFYWNoKGZ1bmN0aW9uKG5leHRTdGF0ZSkge1xuICAgICAgICAgICAgICAgIHZhciBuZXh0U2NvcmUgPSBtaW5pbWF4VmFsdWUobmV4dFN0YXRlKTtcbiAgICAgICAgICAgICAgICBpZihzdGF0ZS50dXJuKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFggd2FudHMgdG8gbWF4aW1pemUgLS0+IHVwZGF0ZSBzdGF0ZVNjb3JlIGlmZiBuZXh0U2NvcmUgaXMgbGFyZ2VyXG4gICAgICAgICAgICAgICAgICAgIGlmKG5leHRTY29yZSA+IHN0YXRlU2NvcmUpXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZVNjb3JlID0gbmV4dFNjb3JlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTyB3YW50cyB0byBtaW5pbWl6ZSAtLT4gdXBkYXRlIHN0YXRlU2NvcmUgaWZmIG5leHRTY29yZSBpcyBzbWFsbGVyXG4gICAgICAgICAgICAgICAgICAgIGlmKG5leHRTY29yZSA8IHN0YXRlU2NvcmUpXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZVNjb3JlID0gbmV4dFNjb3JlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gc3RhdGVTY29yZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qXG4gICAgICogcHJpdmF0ZSBmdW5jdGlvbjogbWFrZSB0aGUgYWkgcGxheWVyIHRha2UgYSBibGluZCBtb3ZlXG4gICAgICogdGhhdCBpczogY2hvb3NlIHRoZSBjZWxsIHRvIHBsYWNlIGl0cyBzeW1ib2wgcmFuZG9tbHlcbiAgICAgKiBAcGFyYW0gdHVybiBbU3RyaW5nXTogdGhlIHBsYXllciB0byBwbGF5LCBlaXRoZXIgWCBvciBPXG4gICAgICovXG4gICAgZnVuY3Rpb24gdGFrZUFCbGluZE1vdmUoKSB7XG4gICAgICAgIHZhciBhdmFpbGFibGUgPSBnYW1lLmN1cnJlbnRTdGF0ZS5lbXB0eUNlbGxzKCk7XG4gICAgICAgIHZhciByYW5kb21DZWxsID0gYXZhaWxhYmxlW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGF2YWlsYWJsZS5sZW5ndGgpXTtcbiAgICAgICAgdmFyIGFjdGlvbiA9IG5ldyBBSUFjdGlvbihyYW5kb21DZWxsKTtcblxuICAgICAgICB2YXIgbmV4dCA9IGFjdGlvbi5hcHBseVRvKGdhbWUuY3VycmVudFN0YXRlKTtcblxuICAgICAgICBnYW1lLmFkdmFuY2VUb1N0YXRlKG5leHQpO1xuICAgIH1cblxuICAgIC8qXG4gICAgICogcHJpdmF0ZSBmdW5jdGlvbjogbWFrZSB0aGUgYWkgcGxheWVyIHRha2UgYSBub3ZpY2UgbW92ZSxcbiAgICAgKiB0aGF0IGlzOiBtaXggYmV0d2VlbiBjaG9vc2luZyB0aGUgb3B0aW1hbCBhbmQgc3Vib3B0aW1hbCBtaW5pbWF4IGRlY2lzaW9uc1xuICAgICAqIEBwYXJhbSB0dXJuIFtTdHJpbmddOiB0aGUgcGxheWVyIHRvIHBsYXksIGVpdGhlciBYIG9yIE9cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0YWtlQU5vdmljZU1vdmUoKSB7XG4gICAgICAgIHZhciBhdmFpbGFibGUgPSBnYW1lLmN1cnJlbnRTdGF0ZS5lbXB0eUNlbGxzKCk7XG5cbiAgICAgICAgLy9lbnVtZXJhdGUgYW5kIGNhbGN1bGF0ZSB0aGUgc2NvcmUgZm9yIGVhY2ggYXZhaWxhYmxlIGFjdGlvbnMgdG8gdGhlIGFpIHBsYXllclxuICAgICAgICB2YXIgYXZhaWxhYmxlQWN0aW9ucyA9IGF2YWlsYWJsZS5tYXAoZnVuY3Rpb24ocG9zKSB7XG4gICAgICAgICAgICB2YXIgYWN0aW9uID0gIG5ldyBBSUFjdGlvbihwb3MpOyAvL2NyZWF0ZSB0aGUgYWN0aW9uIG9iamVjdFxuICAgICAgICAgICAgdmFyIG5leHRTdGF0ZSA9IGFjdGlvbi5hcHBseVRvKGdhbWUuY3VycmVudFN0YXRlKTsgLy9nZXQgbmV4dCBzdGF0ZSBieSBhcHBseWluZyB0aGUgYWN0aW9uXG5cbiAgICAgICAgICAgIGFjdGlvbi5taW5pbWF4VmFsID0gbWluaW1heFZhbHVlKG5leHRTdGF0ZSk7IC8vY2FsY3VsYXRlIGFuZCBzZXQgdGhlIGFjdGlvbidzIG1pbmltYXggdmFsdWVcblxuICAgICAgICAgICAgcmV0dXJuIGFjdGlvbjtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy9zb3J0IHRoZSBlbnVtZXJhdGVkIGFjdGlvbnMgbGlzdCBieSBzY29yZVxuICAgICAgICBpZih0dXJuID09PSBcIlhcIilcbiAgICAgICAgLy9YIG1heGltaXplcyAtLT4gc29ydCB0aGUgYWN0aW9ucyBpbiBhIGRlc2NlbmRpbmcgbWFubmVyIHRvIGhhdmUgdGhlIGFjdGlvbiB3aXRoIG1heGltdW0gbWluaW1heCBhdCBmaXJzdFxuICAgICAgICAgICAgYXZhaWxhYmxlQWN0aW9ucy5zb3J0KEFJQWN0aW9uLkRFU0NFTkRJTkcpO1xuICAgICAgICBlbHNlXG4gICAgICAgIC8vTyBtaW5pbWl6ZXMgLS0+IHNvcnQgdGhlIGFjdGlvbnMgaW4gYW4gYXNjZW5kaW5nIG1hbm5lciB0byBoYXZlIHRoZSBhY3Rpb24gd2l0aCBtaW5pbXVtIG1pbmltYXggYXQgZmlyc3RcbiAgICAgICAgICAgIGF2YWlsYWJsZUFjdGlvbnMuc29ydChBSUFjdGlvbi5BU0NFTkRJTkcpO1xuXG4gICAgICAgIC8qXG4gICAgICAgICAqIHRha2UgdGhlIG9wdGltYWwgYWN0aW9uIDQwJSBvZiB0aGUgdGltZSwgYW5kIHRha2UgdGhlIDFzdCBzdWJvcHRpbWFsIGFjdGlvbiA2MCUgb2YgdGhlIHRpbWVcbiAgICAgICAgICovXG4gICAgICAgIHZhciBjaG9zZW5BY3Rpb247XG4gICAgICAgIGlmKE1hdGgucmFuZG9tKCkqMTAwIDw9IDQwKSB7XG4gICAgICAgICAgICBjaG9zZW5BY3Rpb24gPSBhdmFpbGFibGVBY3Rpb25zWzBdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYoYXZhaWxhYmxlQWN0aW9ucy5sZW5ndGggPj0gMikge1xuICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUgaXMgdHdvIG9yIG1vcmUgYXZhaWxhYmxlIGFjdGlvbnMsIGNob29zZSB0aGUgMXN0IHN1Ym9wdGltYWxcbiAgICAgICAgICAgICAgICBjaG9zZW5BY3Rpb24gPSBhdmFpbGFibGVBY3Rpb25zWzFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy9jaG9vc2UgdGhlIG9ubHkgYXZhaWxhYmxlIGFjdGlvbnNcbiAgICAgICAgICAgICAgICBjaG9zZW5BY3Rpb24gPSBhdmFpbGFibGVBY3Rpb25zWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciBuZXh0ID0gY2hvc2VuQWN0aW9uLmFwcGx5VG8oZ2FtZS5jdXJyZW50U3RhdGUpO1xuXG4gICAgICAgIGdhbWUuYWR2YW5jZVRvU3RhdGUobmV4dCk7XG4gICAgfVxuXG4gICAgLypcbiAgICAgKiBwcml2YXRlIGZ1bmN0aW9uOiBtYWtlIHRoZSBhaSBwbGF5ZXIgdGFrZSBhIG1hc3RlciBtb3ZlLFxuICAgICAqIHRoYXQgaXM6IGNob29zZSB0aGUgb3B0aW1hbCBtaW5pbWF4IGRlY2lzaW9uXG4gICAgICogQHBhcmFtIHR1cm4gW1N0cmluZ106IHRoZSBwbGF5ZXIgdG8gcGxheSwgZWl0aGVyIFggb3IgT1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRha2VBTWFzdGVyTW92ZSgpIHtcbiAgICAgICAgdmFyIGF2YWlsYWJsZSA9IGdhbWUuY3VycmVudFN0YXRlLmVtcHR5Q2VsbHMoKTtcbiAgICAgICAgLy9lbnVtZXJhdGUgYW5kIGNhbGN1bGF0ZSB0aGUgc2NvcmUgZm9yIGVhY2ggYXZhaWFsYWJsZSBhY3Rpb25zIHRvIHRoZSBhaSBwbGF5ZXJcbiAgICAgICAgdmFyIGF2YWlsYWJsZUFjdGlvbnMgPSBhdmFpbGFibGUubWFwKGZ1bmN0aW9uKHBvcykge1xuICAgICAgICAgICAgdmFyIGFjdGlvbiA9ICBuZXcgQUlBY3Rpb24ocG9zKTsgLy9jcmVhdGUgdGhlIGFjdGlvbiBvYmplY3RcbiAgICAgICAgICAgIHZhciBuZXh0ID0gYWN0aW9uLmFwcGx5VG8oZ2FtZS5jdXJyZW50U3RhdGUpOyAvL2dldCBuZXh0IHN0YXRlIGJ5IGFwcGx5aW5nIHRoZSBhY3Rpb25cbiAgICAgICAgICAgIGFjdGlvbi5taW5pbWF4VmFsID0gbWluaW1heFZhbHVlKG5leHQpOyAvL2NhbGN1bGF0ZSBhbmQgc2V0IHRoZSBhY3Rpb24ncyBtaW5tYXggdmFsdWVcbiAgICAgICAgICAgIHJldHVybiBhY3Rpb247XG4gICAgICAgIH0pO1xuICAgICAgICAvL3NvcnQgdGhlIGVudW1lcmF0ZWQgYWN0aW9ucyBsaXN0IGJ5IHNjb3JlXG4gICAgICAgIC8vaWYodHVybiA9PT0gXCJYXCIpXG4gICAgICAgIC8vLy9YIG1heGltaXplcyAtLT4gc29ydCB0aGUgYWN0aW9ucyBpbiBhIGRlc2NlbmRpbmcgbWFubmVyIHRvIGhhdmUgdGhlIGFjdGlvbiB3aXRoIG1heGltdW0gbWluaW1heCBhdCBmaXJzdFxuICAgICAgICAvLyAgICBhdmFpbGFibGVBY3Rpb25zLnNvcnQoQUlBY3Rpb24uREVTQ0VORElORyk7XG4gICAgICAgIC8vZWxzZVxuICAgICAgICAvL08gbWluaW1pemVzIC0tPiBzb3J0IHRoZSBhY3Rpb25zIGluIGFuIGFzY2VuZGluZyBtYW5uZXIgdG8gaGF2ZSB0aGUgYWN0aW9uIHdpdGggbWluaW11bSBtaW5pbWF4IGF0IGZpcnN0XG4gICAgICAgIGF2YWlsYWJsZUFjdGlvbnMuc29ydChBSUFjdGlvbi5BU0NFTkRJTkcpO1xuXG5cbiAgICAgICAgLy90YWtlIHRoZSBmaXJzdCBhY3Rpb24gYXMgaXQncyB0aGUgb3B0aW1hbFxuICAgICAgICB2YXIgY2hvc2VuQWN0aW9uID0gYXZhaWxhYmxlQWN0aW9uc1swXTtcbiAgICAgICAgZ2FtZS5yZW5kZXJQaWVjZShjaG9zZW5BY3Rpb24ubW92ZVBvc2l0aW9uWzFdLCBjaG9zZW5BY3Rpb24ubW92ZVBvc2l0aW9uWzBdLCBmYWxzZSk7XG4gICAgICAgIHZhciBuZXh0ID0gY2hvc2VuQWN0aW9uLmFwcGx5VG8oZ2FtZS5jdXJyZW50U3RhdGUpO1xuICAgICAgICBnYW1lLmFkdmFuY2VUb1N0YXRlKG5leHQpO1xuICAgIH1cblxuXG4gICAgLypcbiAgICAgKiBwdWJsaWMgbWV0aG9kIHRvIHNwZWNpZnkgdGhlIGdhbWUgdGhlIGFpIHBsYXllciB3aWxsIHBsYXlcbiAgICAgKiBAcGFyYW0gX2dhbWUgW0dhbWVdIDogdGhlIGdhbWUgdGhlIGFpIHdpbGwgcGxheVxuICAgICAqL1xuICAgIHRoaXMucGxheXMgPSBmdW5jdGlvbihfZ2FtZSl7XG4gICAgICAgIGdhbWUgPSBfZ2FtZTtcbiAgICB9O1xuXG4gICAgLypcbiAgICAgKiBwdWJsaWMgZnVuY3Rpb246IG5vdGlmeSB0aGUgYWkgcGxheWVyIHRoYXQgaXQncyBpdHMgdHVyblxuICAgICAqIEBwYXJhbSB0dXJuIFtTdHJpbmddOiB0aGUgcGxheWVyIHRvIHBsYXksIGVpdGhlciBYIG9yIE9cbiAgICAgKi9cbiAgICB0aGlzLm1ha2VNb3ZlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHN3aXRjaChsZXZlbE9mSW50ZWxsaWdlbmNlKSB7XG4gICAgICAgICAgICAvL2ludm9rZSB0aGUgZGVzaXJlZCBiZWhhdmlvciBiYXNlZCBvbiB0aGUgbGV2ZWwgY2hvc2VuXG4gICAgICAgICAgICBjYXNlIFwiYmxpbmRcIjogdGFrZUFCbGluZE1vdmUoKTsgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwibm92aWNlXCI6IHRha2VBTm92aWNlTW92ZSgpOyBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJtYXN0ZXJcIjogdGFrZUFNYXN0ZXJNb3ZlKCk7IGJyZWFrO1xuICAgICAgICB9XG4gICAgfTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQUk7IiwiLyoqXG4gKiBDcmVhdGVkIGJ5IHNhdXJhYmhrIG9uIDEwLzA3LzE2LlxuICovXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBncmFwaGljUGFkZGluZzogNTAsXG4gICAgZ2FtZUJvdW5kYXJ5V2lkdGg6MTBcbn07IiwidmFyIFBsYXllciA9IGZ1bmN0aW9uIChnYW1lLCB4LCB5KSB7XG4gICAgUGhhc2VyLlNwcml0ZS5jYWxsKHRoaXMsIGdhbWUsIHgsIHksICd0ZXN0c3ByaXRlJyk7XG4gICAgZ2FtZS5hZGQuZXhpc3RpbmcodGhpcyk7XG59O1xuXG5QbGF5ZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShQaGFzZXIuU3ByaXRlLnByb3RvdHlwZSk7XG5QbGF5ZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUGxheWVyO1xuXG4vKipcbiAqIEF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IFdvcmxkLnVwZGF0ZVxuICovXG5QbGF5ZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gUGxheWVyO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgZ2FtZSA9IG5ldyBQaGFzZXIuR2FtZSg4MDAsIDYwMCwgUGhhc2VyLkFVVE8sICd0aWN0YWN0b2UtZ2FtZScpO1xuXG53aW5kb3cuVXRpbHMgPSByZXF1aXJlKCcuL3V0aWxzL3V0aWxzJyk7XG5yZXF1aXJlKCcuL3V0aWxzL3Byb3RvdHlwZScpO1xud2luZG93LnBsYXllclN0YXRlID0ge1xuICAgIGN1cnJlbnRMZXZlbDogJ0dhbWUnXG59O1xud2luZG93Lmdsb2JhbFVzZXIgPSB7fTtcbmdsb2JhbFVzZXIuc2V0dGluZ3MgPSB7XG4gICAgZ3JpZHM6M1xufTtcbmdsb2JhbFVzZXIucGxheWluZ092ZXJOZXR3b3JrID0gZmFsc2U7XG53aW5kb3cudGltZXMgPSAwO1xuXG5nYW1lLnN0YXRlLmFkZCgnQm9vdCcsIHJlcXVpcmUoJy4vc3RhdGVzL2Jvb3QnKSk7XG5nYW1lLnN0YXRlLmFkZCgnU3BsYXNoJywgcmVxdWlyZSgnLi9zdGF0ZXMvc3BsYXNoJykpO1xuZ2FtZS5zdGF0ZS5hZGQoJ1ByZWxvYWRlcicsIHJlcXVpcmUoJy4vc3RhdGVzL3ByZWxvYWRlcicpKTtcbmdhbWUuc3RhdGUuYWRkKCdNZW51JywgcmVxdWlyZSgnLi9zdGF0ZXMvbWVudScpKTtcbmdhbWUuc3RhdGUuYWRkKCdHYW1lJywgcmVxdWlyZSgnLi9zdGF0ZXMvZ2FtZScpKTtcbmdhbWUuc3RhdGUuYWRkKCdHYW1lT3ZlcicsIHJlcXVpcmUoJy4vc3RhdGVzL2dhbWVPdmVyJykpO1xuXG5nYW1lLnN0YXRlLnN0YXJ0KCdCb290Jyk7XG4iLCJ2YXIgQm9vdCA9IGZ1bmN0aW9uICgpIHtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQm9vdDtcblxuQm9vdC5wcm90b3R5cGUgPSB7XG5cbiAgICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubG9hZC5pbWFnZSgncHJlbG9hZGVyJywgJ2Fzc2V0cy9wcmVsb2FkZXIuZ2lmJyk7XG4gICAgfSxcblxuICAgIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmdhbWUuaW5wdXQubWF4UG9pbnRlcnMgPSAxO1xuICAgICAgICB0aGlzLmdhbWUuc3RhZ2UuYmFja2dyb3VuZENvbG9yID0gXCIjZmZmZmZmXCI7XG4gICAgICAgIGlmICh0aGlzLmdhbWUuZGV2aWNlLmRlc2t0b3ApIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZS5zdGFnZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5nYW1lLnNjYWxlLnNjYWxlTW9kZSA9IFBoYXNlci5TY2FsZU1hbmFnZXIuU0hPV19BTEw7XG4gICAgICAgICAgICB0aGlzLmdhbWUuc2NhbGUubWluV2lkdGggPSA0ODA7XG4gICAgICAgICAgICB0aGlzLmdhbWUuc2NhbGUubWluSGVpZ2h0ID0gMjYwO1xuICAgICAgICAgICAgdGhpcy5nYW1lLnNjYWxlLm1heFdpZHRoID0gNjQwO1xuICAgICAgICAgICAgdGhpcy5nYW1lLnNjYWxlLm1heEhlaWdodCA9IDQ4MDtcbiAgICAgICAgICAgIC8vdGhpcy5nYW1lLnNjYWxlLmZvcmNlTGFuZHNjYXBlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuZ2FtZS5zY2FsZS5wYWdlQWxpZ25Ib3Jpem9udGFsbHkgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5nYW1lLnNjYWxlLnVwZGF0ZUxheW91dCh0cnVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydCgnUHJlbG9hZGVyJyk7XG4gICAgfVxufTtcbiIsInZhciBQbGF5ZXIgPSByZXF1aXJlKCcuLi9lbnRpdGllcy9wbGF5ZXInKTtcbnZhciBjb25maWcgPSByZXF1aXJlKCcuLi9jb25maWcnKTtcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzL3V0aWxzJyk7XG5cbi8vIE5vdCBzdGF0ZSBvZiBwaGFzZXIgYnV0IGdhbWVcbmZ1bmN0aW9uIFN0YXRlKG9sZFN0YXRlKSB7XG4gICAgdmFyIGksajtcbiAgICB0aGlzLnR1cm4gPSBNYXRoLnJhbmRvbSgpID4gMC4zO1xuICAgIHRoaXMuYm9hcmRTdGF0ZSA9IFtdO1xuICAgIHRoaXMub01vdmVzQ291bnQgPSAwO1xuICAgIHRoaXMubGFzdE1vdmUgPSB7fTtcbiAgICB0aGlzLnN0YXR1cyA9IFwiYmVnaW5uaW5nXCI7XG4gICAgdGhpcy5yZXN1bHQgPSBcInJ1bm5pbmdcIjtcblxuICAgIGlmKHR5cGVvZiBvbGRTdGF0ZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAvLyBpZiB0aGUgc3RhdGUgaXMgY29uc3RydWN0ZWQgdXNpbmcgYSBjb3B5IG9mIGFub3RoZXIgc3RhdGVcbiAgICAgICAgdGhpcy5ib2FyZFN0YXRlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvbGRTdGF0ZS5ib2FyZFN0YXRlKSk7XG5cbiAgICAgICAgdGhpcy5vTW92ZXNDb3VudCA9IG9sZFN0YXRlLm9Nb3Zlc0NvdW50O1xuICAgICAgICB0aGlzLnR1cm4gPSBvbGRTdGF0ZS50dXJuO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEluaXRpYWxpemUgYm9hcmQgc3RhdGUgd2l0aCBhbGwgMCBieSBkZWZhdWx0XG4gICAgICAgIGZvcihpID0gMDsgaSA8IGdsb2JhbFVzZXIuc2V0dGluZ3MuZ3JpZHM7IGkrKykge1xuICAgICAgICAgICAgZm9yKGogPSAwOyBqIDwgZ2xvYmFsVXNlci5zZXR0aW5ncy5ncmlkczsgaisrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYm9hcmRTdGF0ZVtpXSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJvYXJkU3RhdGVbaV1bal0gPSAwXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib2FyZFN0YXRlW2ldID0gW107XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYm9hcmRTdGF0ZVtpXVtqXSA9IDBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cblN0YXRlLnByb3RvdHlwZSA9IHtcbiAgICBpc1N0YXRlVGVybWluYWw6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgeCwgeTtcbiAgICAgICAgdmFyIGRpYWdvbmFscyA9IFtbXSwgW11dO1xuICAgICAgICAvLyBDaGVjayByb3dzXG4gICAgICAgIGZvciAoeCA9IDA7IHggPCB0aGlzLmJvYXJkU3RhdGUubGVuZ3RoOyB4KyspIHtcbiAgICAgICAgICAgIHZhciByb3cgPSB0aGlzLmJvYXJkU3RhdGVbeF07XG4gICAgICAgICAgICBpZiAocm93WzBdICE9IDAgJiYgcm93LmlzU2luZ2xlVmFsdWVkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc3VsdCA9IHRoaXMudHVybiA/IFwiT1wiIDogXCJYXCI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBjb2x1bW5zXG4gICAgICAgIGZvciAoeCA9IDA7IHggPCBnbG9iYWxVc2VyLnNldHRpbmdzLmdyaWRzOyB4KyspIHtcbiAgICAgICAgICAgIHZhciBjb2wgPSB0aGlzLmJvYXJkU3RhdGUubWFwKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZVt4XTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKGNvbFswXSAhPSAwICYmIGNvbC5pc1NpbmdsZVZhbHVlZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQgPSB0aGlzLnR1cm4gPyBcIk9cIiA6IFwiWFwiO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgZGlhZ29uYWxzXG4gICAgICAgIGZvciAoeCA9IDA7IHggPCBnbG9iYWxVc2VyLnNldHRpbmdzLmdyaWRzOyB4KyspIHtcbiAgICAgICAgICAgIGZvciAoeSA9IDA7IHkgPCBnbG9iYWxVc2VyLnNldHRpbmdzLmdyaWRzOyB5KyspIHtcbiAgICAgICAgICAgICAgICBpZiAoeCA9PSB5KSB7XG4gICAgICAgICAgICAgICAgICAgIGRpYWdvbmFsc1swXS5wdXNoKHRoaXMuYm9hcmRTdGF0ZVt4XVt5XSk7XG4gICAgICAgICAgICAgICAgICAgIGRpYWdvbmFsc1sxXS5wdXNoKHRoaXMuYm9hcmRTdGF0ZVtnbG9iYWxVc2VyLnNldHRpbmdzLmdyaWRzIC0gMSAtIHhdW3ldKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoeCA9IDA7IHggPCBkaWFnb25hbHMubGVuZ3RoOyB4KyspIHtcbiAgICAgICAgICAgIHZhciBkaWFnb25hbCA9IGRpYWdvbmFsc1t4XTtcbiAgICAgICAgICAgIGlmIChkaWFnb25hbFswXSAhPSAwICYmIGRpYWdvbmFsLmlzU2luZ2xlVmFsdWVkKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc3VsdCA9IHRoaXMudHVybiA/IFwiT1wiIDogXCJYXCI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBEcmF3XG4gICAgICAgIGlmKHRoaXMuZW1wdHlDZWxscygpLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnJlc3VsdCA9IFwiTWF0Y2ggRHJhd25cIjtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGVtcHR5Q2VsbHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgeCx5O1xuICAgICAgICB2YXIgZW1wdHlDZWxscyA9IFtdO1xuICAgICAgICBmb3IoeCA9IDA7eCA8IGdsb2JhbFVzZXIuc2V0dGluZ3MuZ3JpZHM7eCsrKSB7XG4gICAgICAgICAgICBmb3IoeSA9IDA7eSA8IGdsb2JhbFVzZXIuc2V0dGluZ3MuZ3JpZHM7eSsrKSB7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5ib2FyZFN0YXRlW3hdW3ldID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZW1wdHlDZWxscy5wdXNoKFt4LHldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGVtcHR5Q2VsbHM7XG4gICAgfVxufTtcblxudmFyIEdhbWUgPSB7XG5cbiAgICBwcmVsb2FkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdGhpcy5vcHBvbmVudCA9IFwiQUlcIjtcbiAgICAgICAgdGhpcy5ncmFwaGljcyA9IG51bGw7XG4gICAgICAgIHRoaXMuc2VjdGlvblNpemUgPSBudWxsO1xuICAgICAgICB0aGlzLnJlc3VsdCA9IFwicnVubmluZ1wiO1xuICAgICAgICB0aGlzLmRpZmZpY3VsdHlMZXZlbCA9IG51bGw7XG4gICAgICAgIHRoaXMuY3VycmVudFN0YXRlID0gbmV3IFN0YXRlKCk7XG4gICAgICAgIHRoaXMubWVzc2FnZU9uZSA9IFwiXCI7XG4gICAgICAgIHRoaXMubWVzc2FnZVR3byA9IFwiXCI7XG4gICAgICAgIGdsb2JhbFVzZXIuQUkucGxheXModGhpcyk7XG4gICAgfSxcblxuICAgIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaSwgajtcbiAgICAgICAgdmFyIGdyYXBoaWNzID0gdGhpcy5nYW1lLmFkZC5ncmFwaGljcyhjb25maWcuZ3JhcGhpY1BhZGRpbmcsIGNvbmZpZy5ncmFwaGljUGFkZGluZyk7XG4gICAgICAgIHRoaXMuZ3JhcGhpY3MgPSBncmFwaGljcztcbiAgICAgICAgdGhpcy5zZXRUdXJuTWVzc2FnZXMoKTtcbiAgICAgICAgdmFyIHN0eWxlID0ge2ZvbnQ6IFwiMjBweCBBcmlhbFwiLCBmaWxsOiBcIiM2NkNEQUFcIiwgYWxpZ246IFwiY2VudGVyXCJ9O1xuXG4gICAgICAgIHRoaXMudGV4dE1lc3NhZ2UgPSB0aGlzLmFkZC50ZXh0KDIwMCwgMCwgdGhpcy5tZXNzYWdlT25lLCBzdHlsZSk7XG5cbiAgICAgICAgLy8gc2V0IGEgZmlsbCBhbmQgbGluZSBzdHlsZVxuICAgICAgICBncmFwaGljcy5saW5lU3R5bGUoY29uZmlnLmdhbWVCb3VuZGFyeVdpZHRoLCAweGRkZGRkZCk7XG4gICAgICAgIHZhciBncmlkRGV0YWlscyA9IHV0aWxzLmdyaWRTaXplKHRoaXMuZ2FtZSk7XG5cbiAgICAgICAgLy8gVmVydGljYWwgbGluZXNcbiAgICAgICAgZm9yIChpID0gMTsgaSA8IGdsb2JhbFVzZXIuc2V0dGluZ3MuZ3JpZHM7IGkrKykge1xuICAgICAgICAgICAgZ3JhcGhpY3MubW92ZVRvKGkgKiBncmlkRGV0YWlsc1swXSArIChpLTEpICogY29uZmlnLmdhbWVCb3VuZGFyeVdpZHRoLDApO1xuICAgICAgICAgICAgZ3JhcGhpY3MubGluZVRvKGkgKiBncmlkRGV0YWlsc1swXSArIChpLTEpICogY29uZmlnLmdhbWVCb3VuZGFyeVdpZHRoLCBncmlkRGV0YWlsc1sxXSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBIb3Jpem9udGFsIGxpbmVzXG4gICAgICAgIGZvciAoaiA9IDE7IGogPCBnbG9iYWxVc2VyLnNldHRpbmdzLmdyaWRzOyBqKyspIHtcbiAgICAgICAgICAgIGdyYXBoaWNzLm1vdmVUbygwLCBqICogZ3JpZERldGFpbHNbMF0gKyAoai0xKSAqIGNvbmZpZy5nYW1lQm91bmRhcnlXaWR0aCk7XG4gICAgICAgICAgICBncmFwaGljcy5saW5lVG8oZ3JpZERldGFpbHNbMV0sIGogKiBncmlkRGV0YWlsc1swXSArIChqLTEpICogY29uZmlnLmdhbWVCb3VuZGFyeVdpZHRoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNlY3Rpb25TaXplID0gZ3JpZERldGFpbHNbMV0vZ2xvYmFsVXNlci5zZXR0aW5ncy5ncmlkcztcbiAgICAgICAgdGhpcy5pbnB1dC5vbkRvd24uYWRkKHRoaXMuYWRkUGxheWluZ1BpZWNlLCB0aGlzKTtcbiAgICAgICAgaWYgKCF0aGlzLmN1cnJlbnRTdGF0ZS50dXJuICYmIGdsb2JhbFVzZXIuQUkpIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZS50aW1lLmV2ZW50cy5hZGQoUGhhc2VyLlRpbWVyLlNFQ09ORCAqIDEsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgZ2xvYmFsVXNlci5BSS5tYWtlTW92ZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFN0YXRlLm9Nb3Zlc0NvdW50ICs9IDE7XG4gICAgICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgfVxuXG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgIH0sXG5cbiAgICBvbklucHV0RG93bjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQoJ01lbnUnKTtcbiAgICB9LFxuXG4gICAgYWRkUGxheWluZ1BpZWNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHhDb3JkaW5hdGU7XG4gICAgICAgIHZhciB5Q29yZGluYXRlO1xuICAgICAgICB2YXIgc2VjdGlvblNpemUgPSB0aGlzLnNlY3Rpb25TaXplO1xuICAgICAgICB2YXIgbW91c2UgPSB0aGlzLmlucHV0LnBvc2l0aW9uO1xuICAgICAgICBtb3VzZS54ID0gbW91c2UueCAtIGNvbmZpZy5ncmFwaGljUGFkZGluZztcbiAgICAgICAgbW91c2UueSA9IG1vdXNlLnkgLSBjb25maWcuZ3JhcGhpY1BhZGRpbmc7XG5cbiAgICAgICAgZm9yICh2YXIgeCA9IDA7eCA8IGdsb2JhbFVzZXIuc2V0dGluZ3MuZ3JpZHM7eCsrKSB7XG4gICAgICAgICAgICBmb3IgKHZhciB5ID0gMDt5IDwgZ2xvYmFsVXNlci5zZXR0aW5ncy5ncmlkczt5KyspIHtcbiAgICAgICAgICAgICAgICB4Q29yZGluYXRlID0geCAqIHNlY3Rpb25TaXplO1xuICAgICAgICAgICAgICAgIHlDb3JkaW5hdGUgPSB5ICogc2VjdGlvblNpemU7XG5cbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgIG1vdXNlLnggPj0geENvcmRpbmF0ZSAmJiBtb3VzZS54IDw9IHhDb3JkaW5hdGUgKyBzZWN0aW9uU2l6ZSAmJlxuICAgICAgICAgICAgICAgICAgICBtb3VzZS55ID49IHlDb3JkaW5hdGUgJiYgbW91c2UueSA8PSB5Q29yZGluYXRlICsgc2VjdGlvblNpemVcbiAgICAgICAgICAgICAgICAgICAgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy9jbGVhclBsYXlpbmdBcmVhKHhDb3JkaW5hdGUsIHlDb3JkaW5hdGUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTdGF0ZS5sYXN0TW92ZS54ID0geDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUubGFzdE1vdmUueSA9IHk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5jdXJyZW50U3RhdGUuYm9hcmRTdGF0ZVt5XVt4XSA9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlclBpZWNlKHgseSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTdGF0ZS50dXJuID0gIXRoaXMuY3VycmVudFN0YXRlLnR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRTdGF0ZS5ib2FyZFN0YXRlW3ldW3hdID0gXCJYXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkdmFuY2VUb1N0YXRlKHRoaXMuY3VycmVudFN0YXRlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIHJlbmRlclBpZWNlOiBmdW5jdGlvbih4LCB5LCB0dXJuKSB7XG4gICAgICAgIHZhciB4Q29yZGluYXRlID0geCAqIHRoaXMuc2VjdGlvblNpemU7XG4gICAgICAgIHZhciB5Q29yZGluYXRlID0geSAqIHRoaXMuc2VjdGlvblNpemU7XG4gICAgICAgIGlmKHR1cm4pIHtcbiAgICAgICAgICAgIHRoaXMuZHJhd1goeENvcmRpbmF0ZSwgeUNvcmRpbmF0ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmRyYXdPKHhDb3JkaW5hdGUsIHlDb3JkaW5hdGUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudGV4dE1lc3NhZ2UudGV4dCA9IHRoaXMudGV4dE1lc3NhZ2UudGV4dCA9PSB0aGlzLm1lc3NhZ2VPbmUgPyB0aGlzLm1lc3NhZ2VUd28gOnRoaXMubWVzc2FnZU9uZTtcbiAgICB9LFxuXG4gICAgYWR2YW5jZVRvU3RhdGU6IGZ1bmN0aW9uKHN0YXRlKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFN0YXRlID0gc3RhdGU7XG4gICAgICAgIGlmKHRoaXMuY3VycmVudFN0YXRlLmlzU3RhdGVUZXJtaW5hbCgpKSB7XG4gICAgICAgICAgICBzdGF0ZS5zdGF0dXMgPSBcImZpbmlzaGVkXCI7XG4gICAgICAgICAgICB0aGlzLnRleHRNZXNzYWdlLnRleHQ9IFwiXCI7XG4gICAgICAgICAgICBnbG9iYWxVc2VyLnJlc3VsdCA9IHN0YXRlLnJlc3VsdCA9PSBcIlhcIiA/IFwiWW91IHdvblwiIDogKHN0YXRlLnJlc3VsdCA9PSBcIk9cIiA/IFwiWW91IExvc2VcIiA6IFwiTWF0Y2ggRHJhd1wiKTtcbiAgICAgICAgICAgIHRoaXMuZ2FtZS5zdGF0ZS5zdGFydChcIkdhbWVPdmVyXCIsICBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFzdGF0ZS50dXJuKSB7XG4gICAgICAgICAgICBpZihnbG9iYWxVc2VyLkFJKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nYW1lLnRpbWUuZXZlbnRzLmFkZChQaGFzZXIuVGltZXIuU0VDT05EICogMSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsVXNlci5BSS5tYWtlTW92ZSgpO1xuICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3RhdGUub01vdmVzQ291bnQgKz0gMTtcbiAgICAgICAgfVxuICAgICAgICAvL3N0YXRlLnR1cm4gPSAhc3RhdGUudHVybjtcbiAgICB9LFxuXG4gICAgZHJhd086IGZ1bmN0aW9uKHgsIHkpIHtcbiAgICAgICAgdmFyIHNlY3Rpb25TaXplID0gdGhpcy5zZWN0aW9uU2l6ZTtcbiAgICAgICAgdmFyIGdyYXBoaWNzID0gdGhpcy5ncmFwaGljcztcbiAgICAgICAgdmFyIGhhbGZTZWN0aW9uU2l6ZSA9ICgwLjUgKiBzZWN0aW9uU2l6ZSk7XG4gICAgICAgIHZhciBjZW50ZXJYID0geCArIGhhbGZTZWN0aW9uU2l6ZTtcbiAgICAgICAgdmFyIGNlbnRlclkgPSB5ICsgaGFsZlNlY3Rpb25TaXplO1xuICAgICAgICB2YXIgZGlhbWV0ZXIgPSBzZWN0aW9uU2l6ZSAqIDAuNDtcbiAgICAgICAgICAgIGdyYXBoaWNzLmxpbmVTdHlsZSgxMCwgMHgwMWJCQzIpO1xuICAgICAgICAgICAgZ3JhcGhpY3MuZHJhd0NpcmNsZShjZW50ZXJYLCBjZW50ZXJZLCBkaWFtZXRlcik7XG5cbiAgICB9LFxuXG4gICAgZHJhd1g6IGZ1bmN0aW9uKHgseSkge1xuICAgICAgICB2YXIgZ3JhcGhpY3MgPSB0aGlzLmdyYXBoaWNzO1xuICAgICAgICB2YXIgc2VjdGlvblNpemUgPSB0aGlzLnNlY3Rpb25TaXplO1xuICAgICAgICBncmFwaGljcy5saW5lU3R5bGUoMTAsIDB4ZjFiZTMyKTtcbiAgICAgICAgdmFyIG9mZnNldCA9IHNlY3Rpb25TaXplICogMC4zO1xuICAgICAgICBncmFwaGljcy5tb3ZlVG8oeCArIG9mZnNldCwgeSArIG9mZnNldCk7XG4gICAgICAgIGdyYXBoaWNzLmxpbmVUbyh4ICsgc2VjdGlvblNpemUgLSBvZmZzZXQsIHkgKyBzZWN0aW9uU2l6ZSAtIG9mZnNldCk7XG5cbiAgICAgICAgZ3JhcGhpY3MubW92ZVRvKHggKyBvZmZzZXQsIHkgKyBzZWN0aW9uU2l6ZSAtIG9mZnNldCk7XG4gICAgICAgIGdyYXBoaWNzLmxpbmVUbyh4ICsgc2VjdGlvblNpemUgLSBvZmZzZXQsIHkgKyBvZmZzZXQpO1xuICAgIH0sXG5cbiAgICBzY29yZTogZnVuY3Rpb24oX3N0YXRlKSB7XG4gICAgICAgIGlmKF9zdGF0ZS5yZXN1bHQgPT09IFwiWFwiKXtcbiAgICAgICAgICAgIC8vIHRoZSB4IHBsYXllciB3b25cbiAgICAgICAgICAgIHJldHVybiAxMCAtIF9zdGF0ZS5vTW92ZXNDb3VudDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmKF9zdGF0ZS5yZXN1bHQgPT09IFwiT1wiKSB7XG4gICAgICAgICAgICAvL3RoZSB4IHBsYXllciBsb3N0XG4gICAgICAgICAgICByZXR1cm4gLSAxMCArIF9zdGF0ZS5vTW92ZXNDb3VudDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vaXQncyBhIGRyYXdcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIHNldFR1cm5NZXNzYWdlczogZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmKGdsb2JhbFVzZXIuQUkpIHtcbiAgICAgICAgICAgIGlmKHRoaXMuY3VycmVudFN0YXRlLnR1cm4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VPbmUgPSBcIllvdXIgdHVybiwgbWFrZSB5b3VyIG1vdmVcIjtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VUd28gPSBcIlBsZWFzZSB3YWl0LCBBSSBpcyB0aGlua2luZ1wiO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VUd28gPSBcIllvdXIgdHVybiwgbWFrZSB5b3VyIG1vdmVcIjtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VPbmUgPSBcIlBsZWFzZSB3YWl0LCBBSSBpcyB0aGlua2luZ1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYoZ2xvYmFsVXNlci5wbGF5aW5nT3Zlck5ldHdvcmspIHtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlT25lID0gXCJQbGF5ZXIgb25lJ3MgdHVyblwiO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlVHdvID0gXCJQbGF5ZXIgdHdvJ3MgdHVyblwiO1xuICAgICAgICB9XG4gICAgfVxufTtcblxuLy8gRXhwb3J0IEdhbWUgYW5kIG1ha2UgU3RhdGUgZ2xvYmFsXG53aW5kb3cuU3RhdGUgPSBTdGF0ZTtcbm1vZHVsZS5leHBvcnRzID0gR2FtZTtcbiIsIi8qKlxuICogQ3JlYXRlZCBieSBzYXVyYWJoayBvbiAxMS8wNy8xNi5cbiAqL1xudmFyIEdhbWVPdmVyID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudGV4dCA9IG51bGw7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWVPdmVyO1xuXG5HYW1lT3Zlci5wcm90b3R5cGUgPSB7XG5cbiAgICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHggPSB0aGlzLmdhbWUud2lkdGggLyAyO1xuICAgICAgICB2YXIgeSA9IHRoaXMuZ2FtZS5oZWlnaHQgLyAyO1xuXG4gICAgICAgIHZhciBzdHlsZSA9IHtmb250OiBcIjI1cHggQXJpYWxcIiwgZmlsbDogXCIjZGRkZGRkXCIsIGFsaWduOiBcImNlbnRlclwifTtcblxuICAgICAgICB0aGlzLnRleHQgPSB0aGlzLmFkZC50ZXh0KHggLSAzMDAsIDAsIFwiR2FtZU92ZXIsIFwiK2dsb2JhbFVzZXIucmVzdWx0K1wiIGNsaWNrIHRvIHBsYXkgYWdhaW5cIiwgc3R5bGUpO1xuXG4gICAgICAgIHRoaXMuaW5wdXQub25Eb3duLmFkZCh0aGlzLm9uRG93biwgdGhpcyk7XG4gICAgfSxcblxuICAgIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgIH0sXG5cbiAgICBvbkRvd246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KHBsYXllclN0YXRlLmN1cnJlbnRMZXZlbCk7XG4gICAgfVxufTtcbiIsInZhciBBSSA9IHJlcXVpcmUoXCIuLi9BSVwiKTtcbnZhciBNZW51ID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudGV4dCA9IG51bGw7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IE1lbnU7XG5cbk1lbnUucHJvdG90eXBlID0ge1xuXG4gICAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB4ID0gdGhpcy5nYW1lLndpZHRoIC8gMjtcbiAgICAgICAgdmFyIHkgPSB0aGlzLmdhbWUuaGVpZ2h0IC8gMjtcblxuICAgICAgICB2YXIgc3R5bGUgPSB7Zm9udDogXCI2NXB4IEFyaWFsXCIsIGZpbGw6IFwiI2RkZGRkZFwiLCBhbGlnbjogXCJjZW50ZXJcIn07XG5cbiAgICAgICAgdGhpcy50ZXh0ID0gdGhpcy5hZGQudGV4dCh4IC0gMzAwLCB5IC0gMjAwLCBcIlByZXNzIHRvIFN0YXJ0XCIsIHN0eWxlKTtcblxuICAgICAgICB0aGlzLmlucHV0Lm9uRG93bi5hZGQodGhpcy5vbkRvd24sIHRoaXMpO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB9LFxuXG4gICAgb25Eb3duOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHdpbmRvdy5nbG9iYWxVc2VyLkFJID0gbmV3IEFJKFwibWFzdGVyXCIpO1xuICAgICAgICB0aGlzLmdhbWUuc3RhdGUuc3RhcnQocGxheWVyU3RhdGUuY3VycmVudExldmVsKTtcbiAgICB9XG59O1xuIiwidmFyIFByZWxvYWRlciA9IGZ1bmN0aW9uIChnYW1lKSB7XG4gICAgdGhpcy5hc3NldCA9IG51bGw7XG4gICAgdGhpcy5yZWFkeSA9IGZhbHNlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBQcmVsb2FkZXI7XG5cblByZWxvYWRlci5wcm90b3R5cGUgPSB7XG5cbiAgICBwcmVsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuYXNzZXQgPSB0aGlzLmFkZC5zcHJpdGUoMzIwLCAyNDAsICdwcmVsb2FkZXInKTtcbiAgICAgICAgdGhpcy5hc3NldC5hbmNob3Iuc2V0VG8oMC41LCAwLjUpO1xuXG4gICAgICAgIHRoaXMubG9hZC5vbkxvYWRDb21wbGV0ZS5hZGRPbmNlKHRoaXMub25Mb2FkQ29tcGxldGUsIHRoaXMpO1xuICAgICAgICB0aGlzLmxvYWQuc2V0UHJlbG9hZFNwcml0ZSh0aGlzLmFzc2V0KTtcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKCd0ZXN0c3ByaXRlJywgJ2Fzc2V0cy90ZXN0LnBuZycpO1xuICAgIH0sXG5cbiAgICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5hc3NldC5jcm9wRW5hYmxlZCA9IGZhbHNlO1xuICAgIH0sXG5cbiAgICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCEhdGhpcy5yZWFkeSkge1xuICAgICAgICAgICAgdGhpcy5nYW1lLnN0YXRlLnN0YXJ0KCdNZW51Jyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25Mb2FkQ29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5yZWFkeSA9IHRydWU7XG4gICAgfVxufTtcbiIsInZhciBTcGxhc2ggPSBmdW5jdGlvbiAoKSB7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFNwbGFzaDtcblxuU3BsYXNoLnByb3RvdHlwZSA9IHtcbiAgICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB9XG59OyIsIi8qKlxuICogQ3JlYXRlZCBieSBzYXVyYWJoayBvbiAxMC8wNy8xNi5cbiAqL1xuKGZ1bmN0aW9uKCl7XG4gICAgQXJyYXkucHJvdG90eXBlLmlzU2luZ2xlVmFsdWVkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMucmVkdWNlKGZ1bmN0aW9uKGEsIGIpeyByZXR1cm4gKGEgPT09IGIpID8gYSA6IE5hTjsgfSk7XG4gICAgfVxufSkoKTsiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBjb25maWcgPSByZXF1aXJlKCcuLy4uL2NvbmZpZycpO1xudmFyIFV0aWxzID0ge1xuICAgIGNvbnRhaW5zT2JqZWN0OiBmdW5jdGlvbiAob2JqLCBsaXN0KSB7XG4gICAgICAgIHZhciBpO1xuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGxpc3RbaV0gPT09IG9iaikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBncmlkU2l6ZTogZnVuY3Rpb24oZ2FtZSkge1xuICAgICAgICB2YXIgZ2FtZVdpZHRoID0gIE1hdGgubWluKGdhbWUud2lkdGgsIGdhbWUuaGVpZ2h0KSAtIDIgKiBjb25maWcuZ3JhcGhpY1BhZGRpbmc7XG4gICAgICAgIHZhciBncmlkVG90YWxXaWR0aCA9IGdhbWVXaWR0aCAtIChnbG9iYWxVc2VyLnNldHRpbmdzLmdyaWRzIC0gMSkgKiBjb25maWcuZ2FtZUJvdW5kYXJ5V2lkdGg7XG4gICAgICAgIHJldHVybiBbZ3JpZFRvdGFsV2lkdGggLyBnbG9iYWxVc2VyLnNldHRpbmdzLmdyaWRzLCBnYW1lV2lkdGhdO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gVXRpbHM7Il19
